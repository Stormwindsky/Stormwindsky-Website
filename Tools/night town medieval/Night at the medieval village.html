<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medieval Night Village Ambience</title>
    <style>
        :root {
            --night-overlay-color: rgba(0, 10, 30, 0.7);
            --night-filter: brightness(0.6) contrast(1.1) sepia(0.2) hue-rotate(220deg);
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Times New Roman', Times, serif;
            color: #ccc;
            background-color: #000;
            position: relative;
            min-height: 100vh;
        }

        .background-image {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://raw.githubusercontent.com/Stormwindsky/Stormwindsky-website-the-part-under-license-CC-BY-4.0/main/Images/David%20Revoy/night%20town%20medieval/town%20night.jpg');
            background-size: cover;
            background-position: center;
            filter: var(--night-filter);
            transition: filter 2s ease-in-out;
        }

        .night-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--night-overlay-color);
        }

        .firefly-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }

        .firefly {
            position: absolute;
            width: 3px; height: 3px;
            background: rgba(255, 255, 150, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 5px 2px rgba(255, 255, 150, 0.9);
            opacity: 0;
            animation: move-firefly 10s infinite alternate, glow-firefly 1.5s infinite alternate;
        }

        @keyframes move-firefly {
            0% { transform: translate(0, 0) scale(1); opacity: 0; }
            50% { transform: translate(var(--dx), var(--dy)) scale(1.5); opacity: 0.7; }
            100% { transform: translate(var(--dx2), var(--dy2)) scale(1); opacity: 0; }
        }

        @keyframes glow-firefly {
            0% { box-shadow: 0 0 5px 2px rgba(255, 255, 150, 0.9); }
            100% { box-shadow: 0 0 8px 4px rgba(255, 255, 100, 1); }
        }

        .content {
            position: relative;
            z-index: 10;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: fit-content;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin: 20px;
            border: 1px solid #444;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #test-howling {
            padding: 5px 12px;
            background: #333;
            color: #eee;
            border: 1px solid #666;
            border-radius: 4px;
            cursor: pointer;
            font-family: serif;
        }

        #test-howling:hover { background: #555; }

        #credits-button {
            position: fixed;
            bottom: 20px; right: 20px;
            padding: 10px 20px;
            background-color: rgba(50, 50, 50, 0.7);
            color: white;
            border: 1px solid #777;
            border-radius: 5px;
            cursor: pointer;
            z-index: 20;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 30;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.8);
        }

        .modal-content {
            background-color: #222;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
        }

        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <audio id="ambience-audio" loop>
        <source src="https://raw.githubusercontent.com/Stormwindsky/Stormwindsky-Website/main/Tools/night%20town%20medieval/Deep%20wind%20night%20ambience%20in%20village.wav" type="audio/wav">
    </audio>

    <audio id="owl-audio" loop>
        <source src="https://raw.githubusercontent.com/Stormwindsky/Stormwindsky-Website/main/Tools/night%20town%20medieval/owlsfx.wav" type="audio/wav">
    </audio>

    <audio id="howl-audio">
        <source src="https://raw.githubusercontent.com/Stormwindsky/Stormwindsky-Website/main/Tools/night%20town%20medieval/Howling.wav" type="audio/wav">
    </audio>

    <div class="background-image"></div>
    <div class="night-overlay"></div>
    <div class="firefly-container" id="firefly-container"></div>

    <div class="content">
        <div class="control-group">
            <label>Howling Volume:</label>
            <input type="range" id="howl-volume" min="0" max="1" step="0.1" value="0.5">
            <button id="test-howling">Test Howl</button>
        </div>
        <p style="font-size: 0.8em; margin: 0; color: #888;">(Click anywhere to activate the sound)</p>
    </div>

    <button id="credits-button">Notes & Credits</button>

    <div id="credits-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Notes & Credits</h2>
            <p>Background: David Revoy (CC BY 4.0)</p>
            <p>Sounds: eniru, NaturesTemper, Patrick_Corra (CC0)</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const wind = document.getElementById('ambience-audio');
            const owl = document.getElementById('owl-audio');
            const howl = document.getElementById('howl-audio');
            const volSlider = document.getElementById('howl-volume');
            const testBtn = document.getElementById('test-howling');

            // Fonction pour démarrer les sons bouclés
            const startAmbience = () => {
                wind.play();
                owl.play();
                // On retire l'écouteur après le premier clic réussi
                document.removeEventListener('click', startAmbience);
            };

            // Tente de jouer au chargement (échouera souvent sans clic)
            wind.play().catch(() => {
                console.log("Attente d'une interaction utilisateur pour le son...");
            });
            owl.play().catch(() => {});

            // Force le démarrage au premier clic sur la page
            document.addEventListener('click', startAmbience);

            // Gestion du volume du loup
            howl.volume = volSlider.value;
            volSlider.oninput = (e) => howl.volume = e.target.value;

            testBtn.onclick = (e) => {
                e.stopPropagation(); // Évite de déclencher startAmbience deux fois
                howl.currentTime = 0;
                howl.play();
            };

            // Hurlement aléatoire (60-180s)
            function randomHowl() {
                setTimeout(() => {
                    if (howl.paused) howl.play();
                    randomHowl();
                }, Math.random() * (180000 - 60000) + 60000);
            }
            randomHowl();

            // Fireflies
            const container = document.getElementById('firefly-container');
            for (let i = 0; i < 30; i++) {
                const f = document.createElement('div');
                f.className = 'firefly';
                f.style.left = Math.random() * 100 + 'vw';
                f.style.top = Math.random() * 100 + 'vh';
                f.style.animationDuration = (10 + Math.random() * 10) + 's';
                f.style.animationDelay = Math.random() * 10 + 's';
                f.style.setProperty('--dx', (Math.random() * 200 - 100) + 'px');
                f.style.setProperty('--dy', (Math.random() * 200 - 100) + 'px');
                f.style.setProperty('--dx2', (Math.random() * 200 - 100) + 'px');
                f.style.setProperty('--dy2', (Math.random() * 200 - 100) + 'px');
                container.appendChild(f);
            }

            // Modal
            const modal = document.getElementById("credits-modal");
            document.getElementById("credits-button").onclick = () => modal.style.display = "block";
            document.querySelector(".close-button").onclick = () => modal.style.display = "none";
            window.onclick = (e) => { if (e.target == modal) modal.style.display = "none"; }
        });
    </script>
</body>
</html>
